#!/bin/bash

source activate

while [ "$1" != "" ]; do
    case $1 in
        -o | --offline )        export OFFLINE=1
                                ;;
        -r | --remote_db )      export USE_REMOTE_DB=1
                                ;;
        -h | --heroku )         export USE_HEROKU=1
                                ;;
        -? | --help )           usage
                                exit
                                ;;
    esac
    shift
done


export HEROKU_CLI=/usr/local/bin/heroku

# Run the backend server via heroku local if it is available, otherwise gunicorn directly
if [ "$USE_HEROKU" == 1 ] && [ -f "$HEROKU_CLI" ]; then
    echo "running Sanic server via $HEROKU_CLI"
    $HEROKU_CLI local
else
    python -m heatflask.webserver.serve
fi

